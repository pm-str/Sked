//================================================================================
// [pg-calendar]
// version: 1.2.8
// update: 2016.10.09
//================================================================================

function DateManager(a){this.year=parseInt(a.format("YYYY"),10),this.month=parseInt(a.format("MM"),10),this.prevMonth=parseInt(a.clone().add(-1,"months").format("MM"),10),this.nextMonth=parseInt(a.clone().add(1,"months").format("MM"),10),this.day=parseInt(a.format("DD"),10),this.firstDay=1,this.lastDay=parseInt(a.clone().endOf("month").format("DD"),10),this.weekDay=a.weekday(),this.date=a}function Helper(){}var ComponentName="pignoseCalendar",ComponentVersion="1.2.8";window[ComponentName]={VERSION:ComponentVersion},DateManager.prototype.toString=function(){return this.date.format("YYYY-MM-DD")},DateManager.Convert=function(a,b,c){var d=Helper.Format("{0}-{1}-{2}",a,b,c);return moment(d,"YYYY-MM-DD")},!function(){var a={},b={};Helper.Format=function(b){if("undefined"==typeof b||""===b||arguments.length<=1)return"";var c=Array.prototype.slice.call(arguments,1),d=b+c.join("");if("undefined"!=typeof a[d])return a[d];for(var e in c){var f=c[e];b=b.replace(new RegExp("((?!\\\\)?\\{"+e+"(?!\\\\)?\\})","g"),f)}return a[d]=b,b},Helper.GetClass=function(a){var c=ComponentName+a;if("undefined"!=typeof b[c])return b[c];var d=a.split(""),e="";for(var f in d){var g=d[f];"string"==typeof g&&(/[A-Z]/.test(g)===!0&&(e+="-",g=g.toString().toLowerCase()),e+=g.toString())}return b[c]=e,e},Helper.GetSubClass=function(a){return Helper.GetClass(Helper.Format("{0}{1}",ComponentName,a))}}(),"undefined"==typeof Array.prototype.filter&&(Array.prototype.filter=function(a){"use strict";if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)return[];for(var d=[],e=arguments[1],f=0;f<c;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d});var ComponentClass=Helper.GetClass(ComponentName),ComponentPreference={supports:{themes:["light","dark"]}};!function(a){"use strict";var b=a(window),c=(a(document),Helper.GetSubClass("Top")),d=Helper.GetSubClass("Header"),e=Helper.GetSubClass("Body"),f=Helper.GetSubClass("Button"),g={supports:["en","ko","fr","ch","de","jp"],weeks:{en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ko:["일","월","화","수","목","금","토"],fr:["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],ch:["日","月","火","水","木","金","土"],de:["Mon","Die","Mit","Don","Fre","Sam","Son"],jp:["日","月","火","水","木","金","土"]},monthsLong:{en:["January","February","March","April","May","Jun","July","August","September","October","November","December"],ko:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],fr:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],ch:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],de:["Jänner","Feber","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],jp:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},months:{en:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ko:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],fr:["Jan","Fév","Mar","Avr","Mai","Juin","Juil","Aoû","Sep","Oct","Nov","Déc"],ch:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],de:["Jän","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],jp:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]}};a.fn[ComponentName]=function(h){var i={init:function(h){var i=this;this.settings=a.extend({lang:"en",theme:"light",date:moment(),format:"YYYY-MM-DD",weeks:g.weeks.en,monthsLong:g.monthsLong.en,months:g.months.en,multiple:!1,toggle:!1,buttons:!1,modal:!1,select:null,apply:null},h),"en"!==this.settings.lang&&a.inArray(this.settings.lang,g.supports)!==-1&&(this.settings.weeks=g.weeks[this.settings.lang],this.settings.monthsLong=g.monthsLong[this.settings.lang],this.settings.months=g.months[this.settings.lang]),"light"!==this.settings.theme&&a.inArray(this.settings.theme,ComponentPreference.supports.themes)===-1&&(this.settings.theme="light"),this.global={calendarHtml:Helper.Format('<div class="{0} {0}-{4}">\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="{1}">\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="#" class="{1}-nav {1}-prev">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="{1}-icon"></span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="{1}-value"></span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="{1}-date">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p class="{1}-month"></p>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<h3 class="{1}-year"></h3>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="#" class="{1}-nav {1}-next">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="{1}-value"></span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="{1}-icon"></span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="{2}"></div>\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="{3}"></div>\t\t\t\t\t\t\t\t\t\t\t\t</div>',ComponentClass,c,d,e,i.settings.theme),calendarButtonsHtml:Helper.Format('<div class="{0}-group">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="#" class="{0} {0}-cancel">Cancel</a>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="#" class="{0} {0}-apply">OK</a>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>',f)};var j=Helper.GetSubClass("UnitRange"),k=Helper.GetSubClass("UnitRangeFirst"),l=Helper.GetSubClass("UnitRangeLast"),m=Helper.GetSubClass("UnitActive"),n=[Helper.GetSubClass("UnitFirstActive"),Helper.GetSubClass("UnitSecondActive")],o=Helper.GetSubClass("UnitToggle");return this.each(function(){var h=a(this),p=h,q=h,r={calendar:a(i.global.calendarHtml),input:h.is("input"),renderer:null,current:[null,null],storage:{activeDates:[]},dateManager:new DateManager(i.settings.date),calendarWrapperHtml:Helper.Format('<div class="{0}"></div>',Helper.GetSubClass("Wrapper")),calendarWrapperOverlayHtml:Helper.Format('<div class="{0}"></div>',Helper.GetSubClass("WrapperOverlay")),context:i};r.current[0]=r.dateManager.date.clone(),this.local=r;for(var s in i.settings.weeks){var t=i.settings.weeks[s];if("string"==typeof t){t=t.toUpperCase();var u=a(Helper.Format('<div class="{0} {0}-{2}">{1}</div>',Helper.GetSubClass("Week"),t,g.weeks.en[s].toLowerCase()));u.appendTo(r.calendar.find("."+d))}}if(i.settings.buttons===!0){var v=a(i.global.calendarButtonsHtml);v.appendTo(r.calendar)}if(r.input===!0||i.settings.modal===!0){var w=Helper.GetSubClass("WrapperActive"),x=Helper.GetSubClass("WrapperOverlayActive"),y=a("."+Helper.GetSubClass("WrapperOverlay"));y.length<1&&(y=a(r.calendarWrapperOverlayHtml),y.appendTo("body").hide()),q=a(r.calendarWrapperHtml),q.appendTo("body"),q.bind("click",function(a){a.stopPropagation()}),h.bind("click",function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),setTimeout(function(){y.show(),q.show(),b.unbind("resize."+ComponentClass).bind("resize."+ComponentClass,function(){q.css({marginLeft:-q.outerWidth()/2,marginTop:-q.outerHeight()/2})}).triggerHandler("resize."+ComponentClass),p[ComponentName]("set",h.val()),setTimeout(function(){y.addClass(x),q.addClass(w)},25)},25)}).bind("focus",function(b){var c=a(this);c.blur()}),y.bind("click."+ComponentClass,function(){q.trigger("cancel."+ComponentClass)}),q.unbind("cancel."+ComponentClass+" apply."+ComponentClass).bind("cancel."+ComponentClass+" apply."+ComponentClass,function(){y.removeClass(x).hide(),q.removeClass(w).hide()})}var z=function(){if(null===r.current[0]||null===r.current[1])return!1;var a=r.current[0].format("YYYY-MM-DD"),b=r.current[1].format("YYYY-MM-DD"),c=moment(Math.max(r.current[0].valueOf(),r.dateManager.date.clone().startOf("month").valueOf())),d=moment(Math.min(r.current[1].valueOf(),r.dateManager.date.clone().endOf("month").valueOf())),e=c.format("YYYY-MM-DD")!==a,f=d.format("YYYY-MM-DD")!==b;e===!1&&c.add(1,"days"),f===!1&&d.add(-1,"days");for(var g=c.format("YYYY-MM-DD"),h=d.format("YYYY-MM-DD");c.format("YYYY-MM-DD")<=d.format("YYYY-MM-DD");c.add(1,"days")){var i=c.format("YYYY-MM-DD"),m=r.calendar.find(Helper.Format('.{0}[data-date="{1}"]',Helper.GetSubClass("Unit"),i)).addClass(j);i===g&&m.addClass(k),i===h&&m.addClass(l)}};r.renderer=function(){r.calendar.appendTo(q.empty()),r.calendar.find("."+c+"-year").text(r.dateManager.year),r.calendar.find("."+c+"-month").text(i.settings.monthsLong[r.dateManager.month-1]),r.calendar.find(Helper.Format(".{0}-prev .{0}-value",c)).text(i.settings.months[r.dateManager.prevMonth-1].toUpperCase()),r.calendar.find(Helper.Format(".{0}-next .{0}-value",c)).text(i.settings.months[r.dateManager.nextMonth-1].toUpperCase()),i.settings.buttons===!0&&v.find("."+f).bind("click",function(b){b.preventDefault(),b.stopPropagation();var c=a(this);if(c.hasClass(f+"-apply")){p.trigger("apply."+ComponentName,r);var d=null;d=i.settings.toggle===!0?r.storage.activeDates.join(", "):i.settings.multiple===!0?(null===r.current[0]?null:r.current[0].format(i.settings.format))+", "+(null===r.current[1]?null:r.current[1].format(i.settings.format)):null===r.current[0]?null:moment(r.current[0]).format(i.settings.format),r.input===!0&&p.val(d).triggerHandler("change"),"function"==typeof i.settings.apply&&i.settings.apply.call(p,d),q.triggerHandler("apply."+ComponentClass)}else q.triggerHandler("cancel."+ComponentClass)});for(var b=r.calendar.find("."+e).empty(),d=DateManager.Convert(r.dateManager.year,r.dateManager.month,r.dateManager.firstDay),h=d.weekday(),s=a(),t=0;t<h;t++){var u=a(Helper.Format('<div class="{0} {0}-{1}"></div>',Helper.GetSubClass("Unit"),g.weeks.en[t].toLowerCase()));s=s.add(u)}for(var t=r.dateManager.firstDay;t<=r.dateManager.lastDay;t++){var w=DateManager.Convert(r.dateManager.year,r.dateManager.month,t),u=a(Helper.Format('<div class="{0} {0}-date {0}-{3}" data-date="{1}"><a href="#">{2}</a></div>',Helper.GetSubClass("Unit"),w.format("YYYY-MM-DD"),t,g.weeks.en[w.weekday()].toLowerCase()));i.settings.toggle===!0?a.inArray(w.format("YYYY-MM-DD"),r.storage.activeDates)!==-1&&r.storage.activeDates.length>0&&u.addClass(o):i.settings.multiple===!0?(null!==r.current[0]&&w.format("YYYY-MM-DD")===r.current[0].format("YYYY-MM-DD")&&u.addClass(m).addClass(n[0]),null!==r.current[1]&&w.format("YYYY-MM-DD")===r.current[1].format("YYYY-MM-DD")&&u.addClass(m).addClass(n[1])):null!==r.current[0]&&w.format("YYYY-MM-DD")===r.current[0].format("YYYY-MM-DD")&&u.addClass(m).addClass(n[0]),s=s.add(u),u.bind("click",function(b){b.preventDefault(),b.stopPropagation();var c=a(this),d=0;if(r.input===!0&&i.settings.multiple===!1&&i.settings.buttons===!1){var e=c.data("date");return p.val(moment(e).format(i.settings.format)),q.triggerHandler("apply."+ComponentClass),!1}if(i.settings.toggle===!0){var e=c.data("date"),f=r.storage.activeDates.filter(function(a,b){return a==e});if(r.current[d]=moment(e),f.length<1)r.storage.activeDates.push(e),c.addClass(o);else{var g=0;for(var h in r.storage.activeDates){var s=r.storage.activeDates[h];if(e==s){g=h;break}}r.storage.activeDates.splice(g,1),c.removeClass(o)}}else if(i.settings.multiple===!0&&r.calendar.find("."+j).removeClass(j).removeClass(k).removeClass(l),c.hasClass(m))i.settings.multiple===!0&&(c.hasClass(n[0])?d=0:n[1]&&(d=1)),c.removeClass(m).removeClass(n[d]),r.current[d]=null;else if(i.settings.multiple===!0&&(null===r.current[0]?d=0:null===r.current[1]?d=1:(d=0,r.current[1]=null,r.calendar.find("."+m+"."+n[1]).removeClass(m).removeClass(n[1]))),r.calendar.find("."+m+"."+n[d]).removeClass(m).removeClass(n[d]),c.addClass(m).addClass(n[d]),r.current[d]=moment(c.data("date")),i.settings.multiple===!0&&null!==r.current[0]&&null!==r.current[1]){if(r.current[0].diff(r.current[1])>0){var t=r.current[0];r.current[0]=r.current[1],r.current[1]=t,t=null,r.calendar.find("."+m).each(function(){for(var b in n){var c=n[b];a(this).toggleClass(c)}})}r.input===!0&&i.settings.buttons===!1&&(p.val((null===r.current[0]?null:r.current[0].format(i.settings.format))+", "+(null===r.current[1]?null:r.current[1].format(i.settings.format))),q.trigger("apply."+ComponentClass)),z.call()}"function"==typeof i.settings.select&&i.settings.select.call(c,r.current,r)})}for(var x=DateManager.Convert(r.dateManager.year,r.dateManager.month,r.dateManager.lastDay),y=x.weekday(),t=y+1;s.length<=35;t++){var u=a(Helper.Format('<div class="{0} {0}-{1}"></div>',Helper.GetSubClass("Unit"),g.weeks.en[t%7].toLowerCase()));s=s.add(u)}var A=null;s.each(function(c,d){(c%7==0||c+1>=s.length)&&(null!=A&&A.appendTo(b),c+1<s.length&&(A=a(Helper.Format('<div class="{0}"></div>',Helper.GetSubClass("Row"))))),A.append(a(this))}),r.calendar.find("."+c+"-nav").bind("click",function(b){b.preventDefault(),b.stopPropagation();var d=a(this);d.hasClass(c+"-prev")?(r.dateManager=new DateManager(r.dateManager.date.clone().add(-1,"months")),r.renderer.call()):d.hasClass(c+"-next")&&(r.dateManager=new DateManager(r.dateManager.date.clone().add(1,"months")),r.renderer.call())}),i.settings.multiple===!0&&(r.calendar.find("."+j).removeClass(j).removeClass(k).removeClass(l),z.call())},r.renderer.call(),h[0][ComponentName]=r})},set:function(b){if("undefined"!=typeof b&&null!==b&&""!==b){var c=b.split(",").map(function(b){return a.trim(b)});this.each(function(){var b=a(this),d=b[0][ComponentName],e=d.context,f=[null===c[0]?null:moment(c[0],e.settings.format),null===c[1]?null:moment(c[1],e.settings.format)];d.dateManager=new DateManager(f[0]),e.settings.toggle===!0?d.storage.activeDates=c:d.current=f,d.renderer.call()})}},select:function(b){this.each(function(){var c=this.local,d=c.dateManager,e=Helper.Format("{0}-{1}-{2}",d.year,d.month,b);a(this).find(Helper.Format('.{0}[data-date="{1}"]',Helper.GetSubClass("Unit"),e)).triggerHandler("click")})}};return i[h]?i[h].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof h&&h?void console.error("Argument error are occured."):i.init.apply(this,arguments)}}(jQuery);